class Tag{constructor({name:e,inner:t,attrs:n={}}={}){this.name=e,this.inner=t,this.attrs=n}stringifyAttrs(){var e=[];return this.attrs.forEach(function(t){e.push(t.content)}),e.join(" ")}get content(){return`<${this.name}${this.attrs.length?" "+this.stringifyAttrs():""}>${this.inner}</${this.name}>`}}Tag.Attribute=class{constructor({name:e,values:t}={}){this.name=e,this.values=t}get content(){return`${this.name}="${this.values.join(" ")}"`}};class Schedule{constructor({data:e,config:t}={}){this.config=new Schedule.Config(t),this.groups=this.parseData(e);var n=this.getTimeBorders();this.timeBorderMax=n.max,this.timeBorderMin=n.min}static get DAY_MS(){return 864e5}parseData(e){var t=[];return e.forEach(function(e){var n=[],i=new Schedule.Group({title:e.title,id:e.id,tasks:null,data:e});e.tasks.forEach(function(e){n.push(new Schedule.Task({title:e.title,id:e.id,group:i,initial_date:e.initial_date,end_date:e.end_date,data:e}))}),i.tasks=n,t.push(i)}),t}getTimeBorders(){var e=Number.MAX_SAFE_INTEGER,t=0;return this.groups.forEach(function(n){n.tasks.forEach(function(n){n.initial_date.getTime()<e&&(e=n.initial_date.getTime()),n.end_date.getTime()>t&&(t=n.end_date.getTime())})}),{min:e,max:t}}get html_table(){return new Schedule.HTMLTable({schedule:this}).html}start(){var e=this;document.getElementById(e.config.container_id).innerHTML=e.html_table,this.groups.forEach(function(t){var n=document.getElementById(`id-schedule-group-${t.id}`);n&&n.addEventListener("click",function(){e.config.onclick.group_label(t)}),t.tasks.forEach(function(t){var n=document.getElementById(`id-schedule-task-${t.id}`),i=document.getElementById(`id-schedule-time-${t.id}`);n&&n.addEventListener("click",function(){e.config.onclick.task_label(t)}),i&&i.addEventListener("click",function(){e.config.onclick.time_section(t)})})})}}Schedule.Config=class{constructor({container_id:e,resolution:t,title:n,onclick:i,render:a}={}){this.container_id=e,this.resolution=t,this.title=n,this.onclick=new Schedule.Config.OnClick(i),this.render=new Schedule.Config.Render(a),console.log(a)}},Schedule.Config.OnClick=class{constructor({group_label:e=this.logonconsole,task_label:t=this.logonconsole,time_section:n=this.logonconsole}={}){this.group_label=e,this.task_label=t,this.time_section=n}logonconsole(e){console.log(e)}},Schedule.Config.Render=class{constructor({group_label:e=this.group_label,task_label:t=this.task_label}={}){this.group_label=e,this.task_label=t}group_label(e){return e.title}task_label(e){return e.title}},Schedule.Task=class{constructor({title:e,id:t,group:n,initial_date:i,end_date:a,data:s}={}){this.title=e,this.id=t,this.group=n,this.data=s,this.initial_date=new Date(i);var r=new Date(a).getTime();this.end_date=new Date(r+Schedule.DAY_MS-1)}},Schedule.Group=class{constructor({title:e,id:t,tasks:n,data:i}={}){this.title=e,this.id=t,this.data=i,this.tasks=n}},Schedule.HTMLTable=class{constructor({schedule:e}={}){this.schedule=e,this.config,this.section_time=(e.timeBorderMax-e.timeBorderMin)/e.config.resolution}tdSection({colspan:e,attrs:t=[]}={}){if(e){var n=new Tag.Attribute({name:"colspan",values:[String(e)]});return new Tag({name:"td",inner:"",attrs:[n].concat(t)}).content}return""}simplify_date(e){return{d:e.getUTCDate(),m:e.getUTCMonth()+1,y:e.getUTCFullYear()}}htmlTimeCells(e){this.schedule.config.resolution;for(var t=e.initial_date.getTime(),n=e.end_date.getTime(),i=0,a=0,s=1;s<=this.schedule.config.resolution;s++){var r=this.schedule.timeBorderMin+s*this.section_time;r>t&&r<=n&&(i=0==i?s:i,a++)}s=this.simplify_date(e.initial_date);var l=this.simplify_date(e.end_date),o=Math.ceil((e.end_date-e.initial_date)/Schedule.DAY_MS),c=new Tag.Attribute({name:"data-toggle",values:["tooltip"]}),d=new Tag.Attribute({name:"data-html",values:["true"]}),u=new Tag.Attribute({name:"title",values:[`${o} dia${o>1?"s":""}, de <b>${s.d}/${s.m}/${s.y.toString().substr(-2)}</b> a <b>${l.d}/${l.m}/${l.y.toString().substr(-2)}</b>`]}),h=new Tag.Attribute({name:"data-container",values:["body"]}),g=new Tag.Attribute({name:"class",values:["schedule-intime","test","schedule-clickable"]}),m=new Tag.Attribute({name:"id",values:[`id-schedule-time-${e.id}`]}),_=this.tdSection({colspan:a,attrs:[g,m,c,d,u,h]});i-=1;g=new Tag.Attribute({name:"class",values:["schedule-outtime"]});var f=this.tdSection({colspan:i,attrs:[g]}),b=this.schedule.config.resolution-(i+a);return[f,_,this.tdSection({colspan:b,attrs:[g]})]}get html(){var e=this,t=[],n=this.simplify_date(new Date(this.schedule.timeBorderMin)),i=this.simplify_date(new Date(this.schedule.timeBorderMax)),a=Math.ceil((this.schedule.timeBorderMax-this.schedule.timeBorderMin)/Schedule.DAY_MS),s=`PerÃ­odo de ${n.d}/${n.m}/${n.y.toString().substr(-2)} a ${i.d}/${i.m}/${i.y.toString().substr(-2)} (${a} dia${a>1?"s":""})`,r=new Tag({name:"td",inner:this.schedule.timeBorderMax?s:""}).content,l=[];for(n=0;n<this.schedule.config.resolution;n++)l.push(new Tag({name:"td",inner:" "}).content);var o=new Tag.Attribute({name:"class",values:["colspanreference"]}),c=(t=[new Tag({name:"tr",inner:r+l.join(""),attrs:[o]}).content],new Tag.Attribute({name:"class",values:["schedule-clickable"]}));this.schedule.groups.forEach(function(n){var i=new Tag.Attribute({name:"class",values:["schedule-group-label"]}),a=new Tag.Attribute({name:"id",values:[`id-schedule-group-${n.id}`]}),s=new Tag({name:"span",inner:e.schedule.config.render.group_label(n),attrs:[a,c]}).content,r=new Tag({name:"b",inner:s}).content,l=new Tag({name:"td",inner:r,attrs:[i]}).content,o=e.tdSection({colspan:e.schedule.config.resolution,attrs:[i]}),d=new Tag({name:"tr",inner:l+o}).content;t.push(d),n.tasks.forEach(function(n){var i=new Tag.Attribute({name:"class",values:["schedule-label"]}),a=new Tag.Attribute({name:"id",values:[`id-schedule-task-${n.id}`]}),s=new Tag({name:"span",inner:e.schedule.config.render.task_label(n),attrs:[a,c]}).content,r=new Tag({name:"td",inner:s,attrs:[i]}),l=e.htmlTimeCells(n);l.unshift(r.content),t.push(new Tag({name:"tr",inner:l.join("")}).content)})});o=new Tag.Attribute({name:"class",values:["schedule"]});return new Tag({name:"table",inner:t.join("\n"),attrs:[o]}).content}};